// Copyright 2019 Eric Michael Veilleux - Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0
var clone=n=>JSON.parse(JSON.stringify(n));function parseNums(n,e,r){if(-1==["string","object"].indexOf(typeof n))throw new TypeError("The first number wasn't a string (or object). It has to be a string (or object). Note that an object input is ment to submit a pre-parsed number.");if(-1==["string","object"].indexOf(typeof e))throw new TypeError("The second number wasn't a string (or object). It has to be a string (or object). Note that an object input is ment to submit a pre-parsed number.");if("number"!=typeof r||-1==[1,2,3,4,5].indexOf(r))throw new TypeError("The mode must be a number from 1-5.");var t,i,s,u,a=n,m=e,l=!1,o=!0,f=!0,g=[!1,!1,!1],c=0,d=0,h=0;null!=a.num&&(g[1]=n.isNeg,d=n.decimals,a=n.num,o=!1),null!=m.num&&(g[2]=e.isNeg,h=e.decimals,m=e.num,f=!1),o&&2==a.split("-").length&&(a=a.split("-")[1],g[1]=!0),f&&2==m.split("-").length&&(m=m.split("-")[1],g[2]=!0),g[1]!=g[2]&&1!=r&&2!=r&&(g[0]=!0),o&&(a=a.split("").filter(n=>","!=n)),f&&(m=m.split("").filter(n=>","!=n)),d=-1!=(t=a.indexOf("."))?a.filter(n=>"."!=n).length-t:0,h=-1!=(i=m.indexOf("."))?m.filter(n=>"."!=n).length-i:0,c=1==r||2==r?Math.max(d,h):3==r?d+h:d-h,s=Math.max(a.length,m.length),c<0&&(c=0);for(var p=0;!l&&(g[1]||g[2])&&1==r&&m.length==s&&p<a.length;p++)+m[p]>+a[p]&&(g[0]=!0,l=!0);for(p=0;!l&&2==r&&m.length==s&&p<a.length;p++)a[p]<m[p]?(g[0]=!0,l=!0):l=!(m[p]==a[p]);if(m.length==s&&m.length!=s&&(g[0]=!0),s==m.length&&3==r&&(a=[m,m=a][0]),d!=h&&[1,2].indexOf(r)>-1)if(d==c)for(p=0;p<d-h;p++)m.push("0");else if(h==c)for(p=0;p<h-d;p++)a.push("0");if(a.length!=m.length&&[1,2].indexOf(r)>-1)if(s==(u=[a.length,m.length])[0])for(p=0;p<u[0]-u[1];p++)m.unshift("0");else if(s!=a[0])for(p=0;p<u[1]-u[0];p++)a.unshift("0");return 3==r&&g.every(n=>1==n)&&(g[0]=!1),{num1:{num:a,isNeg:g[1],decimals:d},num2:{num:m,isNeg:g[2],decimals:h},isNeg:g[0],maxChar:s,decimals:c}}function formatNums(n,e,r){return"string"==typeof n?e>0&&((n=n.split("")).splice(n.length-e,0,"."),n=n.join("")):"object"==typeof n&&(e>0?((n=n.reverse()).splice(n.length-e,0,"."),n=n.join("")):n=n.reverse().join("")),n=r[0]?"-"+n:n,n=["",".","-"].indexOf(n)>-1?"0":n}function add(){function n(n,e){var r,t,i=parseNums(n,e,1),s=[i.isNeg,i.num1.isNeg,i.num2.isNeg],u=i.maxChar,a=[i.decimals,i.num1.decimals,i.num2.decimals],m=(n=i.num1.num,e=i.num2.num,[]),l="0";if(s[2])return sub(i.num1,{num:e,isNeg:!1,decimals:a[1]});if(s[1])return sub(i.num2,{num:n,isNeg:!1,decimals:a[2]});for(var o=u-1;o>=0;o--)if(r!=o+1&&(l="0"),m[t=u-o-1]=String(+n[o]+ +e[o]+ +l),+m[t]>9){var f=m[t].split("");m[t]=f[1],l=f[0],r=o,o-1<0&&m.push(l)}return formatNums(m,a[0],s)}var e,r=clone(arguments);Array.isArray(r[0])&&(r=r[0]),e=n(r[0],r[1]);for(var t=2;t<r.length;t++)e=n(e,r[t]);return e}function sub(){function n(n,e){var r,t,i=parseNums(n,e,2),s=[i.isNeg,i.num1.isNeg,i.num2.isNeg],u=i.maxChar,a=[i.decimals,i.num1.decimals,i.num2.decimals],m=i.num1.num,l=i.num2.num,o=[];if(s.indexOf(!0)>-1)if(!s[0]||s[1]||s[2])if(s[1]&&s[2])m=[l,l=m][0];else{if(s[2]&&!s[1])return add(i.num1,{num:l,isNeg:!1,decimals:a[2]});if(s[1]&&!s[2])return"-"+add({num:m,isNeg:!1,decimals:a[1]},i.num2)}else m=[l,l=m][0];for(var f=u-1;f>=0;f--)if(r=u-f-1,(t=m[f]-l[f])<0&&0!=f){var g=f-1;for(o[r]=String(t+10),m[g]=String(m[g]-1);m[g]<0&&0!=g;)m[g]=String(+m[g]+10),m[g-=1]=String(m[g]-1)}else o[r]=t<0&&0==f?String(t).split("-")[1]:t;return formatNums(o,a[0],s)}var e,r=clone(arguments);Array.isArray(r[0])&&(r=r[0]),e=n(r[0],r[1]);for(var t=2;t<r.length;t++)e=n(e,r[t]);return e}function isLessThan(){function n(n,e){var r=sub(e,n);return 1==r.split("-").length&&0!=r}var e,r=clone(arguments);Array.isArray(r[0])&&(r=r[0]),e=n(r[0],r[1]);for(var t=2;t<r.length;t++)e=n(e,r[t]);return e}function isGreaterThan(){function n(n,e){var r=sub(n,e);return 1==r.split("-").length&&0!=r}var e,r=clone(arguments);Array.isArray(r[0])&&(r=r[0]),e=n(r[0],r[1]);for(var t=2;t<r.length;t++)e=n(e,r[t]);return e}function isLessThanEqual(){function n(n,e){return 1==sub(e,n).split("-").length}var e,r=clone(arguments);Array.isArray(r[0])&&(r=r[0]),e=n(r[0],r[1]);for(var t=2;t<r.length;t++)e=n(e,r[t]);return e}function isGreaterThanEqual(){function n(n,e){return 1==sub(n,e).split("-").length}var e,r=clone(arguments);Array.isArray(r[0])&&(r=r[0]),e=n(r[0],r[1]);for(var t=2;t<r.length;t++)e=n(e,r[t]);return e}function round(n){return(n=n.split("."))[1]=n[1].split(""),isGreaterThanEqual(n[1][0],{num:["5"],isNeg:!1,decimals:0})?add(n[0],{num:["1"],isNeg:!1,decimals:0}):n[0]}function roundDown(n){return n.split(".")[0]}function roundUp(n){return add(n.split(".")[0],{num:["1"],isNeg:!1,decimals:0})}function multi(){function n(n,e){var r=parseNums(n,e,3),t=[r.isNeg,r.num1.isNeg,r.num2.isNeg],i="",s=r.decimals,u=r.num2,a=r.num1;if(1==u.num.length&&"1"==u.num[0])return formatNums(u.num,s,t);if(1==u.length&&"0"==u[0])return"1";i=add(a,a);for(var m="2";isLessThan(m,u);m=add({num:m.split(""),isNeg:!1,decimals:0},{num:["1"],isNeg:!1,decimals:0}))i=add(i,a);return formatNums(i,s,t)}var e,r=clone(arguments);Array.isArray(r[0])&&(r=r[0]),e=n(r[0],r[1]);for(var t=2;t<r.length;t++)e=n(e,r[t]);return e}function expo(){function n(n,e){var r=parseNums(n,e,5),t=r.num1,i=r.num2,s=r.decimals,u=r.num2.decimals,a=[r.isNeg,r.num1.isNeg,r.num2.isNeg],m="";if(a[1]&&t.num.unshift("-"),a[2]&&i.num.unshift("-"),u>0)throw alert("Decimal exponents aren't supported yet"),new TypeError("Decimal exponents aren't supported yet");if(1==i.num.length&&"1"==i.num[0])return formatNums(i.num,s,!1);if(1==i.num.length&&"0"==i.num[0])return"1";m=multi(t,t);for(var l="2";isLessThan(l,i);l=add({num:l.split(""),isNeg:!1,decimals:0},{num:["1"],isNeg:!1,decimals:0}))m=multi(m,t);return m}var e,r=clone(arguments);Array.isArray(r[0])&&(r=r[0]),e=n(r[0],r[1]);for(var t=2;t<r.length;t++)e=n(e,r[t]);return e}var a=add,s=sub,m=multi,e=expo,l=isLessThan,g=isGreaterThan,le=isLessThanEqual,ge=isGreaterThanEqual,r=round,ru=roundUp,rd=roundDown;
