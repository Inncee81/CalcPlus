<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta name="author" content="Virx">
    <meta name="description" content="Preview the Big Number Calculator open-source library">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://i.ibb.co/brGqmZW/calc.png">
    <script src="https://virxec.github.io/BigNumberCalculator/BNC-Lib.js"></script>
    <title>CalcPlus</title>
    <style>
      body {
        font-size:15pt;
        background:grey;
      }
      a {
        color:lightblue;
      }
      .removeInput {
          color: grey;
          background: rgb(255, 110, 110);
          border: none;
      }
      .removeInput:hover {
          color:black;
          background: red;
          border: none;
      }
    </style>
  </head>
  <body>
    <noscript>Library couldn't be loaded! Please allow JavaScript to run on this page, or else most things won't work. Thank you!<br></noscript>
    <span id="notification"></span>
    <a href="https://virxec.github.io/BigNumberCalculator">Home</a>
    <h3>Want to browse around offline?<button id="goOffline" onclick="registerWorkers()">Click here!!!</button></h3>
    <form>
      <input type="radio" id="add" name="math-type" label="Addition Algorithm" checked="checked"> Addition
      <br>
      <input type="radio" id="sub" name="math-type" label="Subtraction Algorithm"> Subtraction
      <br>
      <input type="radio" id="multi" name="math-type" label="Multiplication Algorithm - In development"> Multiplication (In development)
      <br>
      <input type="radio" id="div" name="math-type" label="Division Algorithm - Unavailable"> Division (Unavailable)
    </form>
    <br>
    <button id="addInput">Add another input field</button>
    <br>
    Number: <input type="text" id="input1" label="Number input field #1">
    <br>
    Number: <input type="text" id="input2" label="Number input field #2">
    <br>
    <span id="extraInputs"></span>
    <button id="calc">Calculate...</button>
    <br>
    <br>
    <p id="output">Press "Calculate..."</p>
    
    <script>
      var goOffline = document.getElementById("goOffline");
      
      if(localStorage.getItem("isOffline") == "true") {
        document.getElementById("notification").innerHTML = "<h2>Please note that this page won't work completely, as since you're offline, the BNC Library couldn't be loaded. Please <h2>";
        goOffline.parentNode.remove(0);
      }
      
      function registerWorkers() {
        goOffline.textContent = "Checking...";
        if('serviceWorker' in navigator) {
          goOffline.textContent = "Loading Service Wokers...";
          
          function root(ex) {
            return "https://virxec.github.io/BigNumberCalculator/"+ex
          }
          
          function swReg(ex) {
            navigator.serviceWorker.register(root(ex));
          }
          
          swReg("index.html");
          swReg("PreviewLibrary.html");
          swReg("LibrarySource.html");
          swReg("AboutLibrary.html");
          
          localStorage.setItem("isOffline", "true");
          document.getElementById("notification").innerHTML = "<h2>Please note that this page won't work completely, as since you're offline, the BNC Library couldn't be loaded. Please <h2>";
          goOffline.parentNode.remove(0);
        } else {
          goOffline.textContent = "Your browser doesn't support Service Workers. Please use one of the major browsers, like Google Chrome.";
        }
      }
      
      if (localStorge.getItem("isOffline") == "true") {
        self.addEventListener('install', function(event) {
          event.waitUntil(
            caches.open('v1').then(function(cache) {
              return cache.addAll([
                root("index.html"),
                root("PreviewLibrary.html"),
                root("LibrarySource.html"),
                root("AboutLibrary.html")
              ]);
            })
          );
        });
        
        self.addEventListener('fetch', (e) => {
         e.respondWith(caches.match(e.request).then((response) => {
          if(response) return response
          else return fetch(e.request)
         }) )
        })
      }
    </script>
    <script>
      "use strict";
      try {
        var inputBoxes = 2;
        var getChecked = function(name) {
          return document.getElementById(name).checked;
        };

        var runCalc = function() {
          var final = {
            num: 0,
            display: false
          };
          if (getChecked("add")) {
            final.num = add(document.getElementById("input1").value, document.getElementById("input2").value);
            if (inputBoxes > 2) {
              for (var i=3; i<=inputBoxes; i++) {
                final.num = add(final.num, document.getElementById("input"+i.toString()).value);
              }
            }
            final.display = true;
          } else if (getChecked("sub")) {
            final.num = sub(document.getElementById("input1").value, document.getElementById("input2").value);
            if (inputBoxes > 2) {
              for (var s=3; s<=inputBoxes; s++) {
                final.num = sub(final.num, document.getElementById("input"+s.toString()).value);
              }
            }
            final.display = true;
          } else if (getChecked("multi")) {
            final.num = multi(document.getElementById("input1").value, document.getElementById("input2").val());
            if (inputBoxes > 2) {
              for (var m=3; m<=inputBoxes; m++) {
                final.num = multi(final.num, document.getElementById("input"+m.toString()).value);
              }
            }
            final.display = true;
          } else if (getChecked("div")) {
            console.warn("Division algorithm was called, but doesn't exist.");
          } else {
            console.error("ran nothing");
          }

          if (final.display) {
            document.getElementById("output").textContent = "Answer: "+final.num;
          }
        };

        function removeInput() {
          inputBoxes--;
          document.getElementById("console").innerHTML += inputBoxes;
        }

        document.getElementById("addInput").addEventListener("click", function(){
          inputBoxes++;
          document.getElementById("extraInputs").innerHTML += '<span id="id'+inputBoxes+'">Number: <input type="text" id="input'+inputBoxes+'" label="Number input field #'+inputBoxes+'"/> <button class="removeInput" id="'+inputBoxes+'" onclick="this.parentNode.remove();removeInput();" label="Delete input field #'+inputBoxes+'">X</button><br></span>';
        });

        document.getElementById("calc").addEventListener("click", function(){
          runCalc();
        });
      } catch(err) {
        console.error(err);
      }
    </script>
  </body>
</html>
