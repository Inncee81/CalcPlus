<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="Works with really large numbers">
    <meta name="author" content="Virx">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://virxec.github.io/CalcPlus/assets/logo.png">
    <script src="https://virxec.github.io/CalcPlus/assets/CPquery.js"></script>
    <title>CalcPlus Page Options</title>
    <noscript>Please allow JavaScript to run on this page, or else most things won't work. Thank you!<br></noscript>
    <style>
      body {
        color: black;
        background-color: white;
      }
      a {
        color: rgb(0, 0, 192);
      }
    </style>
  </head>
  <body>
    <span class="console"></span>
    <h1>Page Options</h1>
    <h2><a href="https://virxec.github.io/CalcPlus">Home</a></h2>
    <h3>Offline Mode <button id="offlineMode" onclick="toggleOffline()">Off</button></h3>
    <h3>Dark Mode <button id="darkMode" onclick="toggleDarkMode()">Off</button></h3>
    
    <script>
      var c = document.querySelector(".console");
      console.log = (...args) => args.forEach(m => c.appendChild(document.createTextNode(`\n ${m}`)));
      console.info = (...args) => args.forEach(e => {
        const s = document.createElement("span");
        s.textContent = "\n" + e;
        s.style.color = "blue";
        c.appendChild(s);
      });
      console.warn = (...args) => args.forEach(e => {
        const s = document.createElement("span");
        s.textContent = "\n" + e;
        s.style.color = "yellow";
        c.appendChild(s);
      });
      console.error = (...args) => args.forEach(e => {
        const s = document.createElement("span");
        s.textContent = "\n" + e;
        s.style.color = "red";
        c.appendChild(s);
      });
        
      window.onerror = (e, s, l, c) => {
        console.error(`Error: ${e} at: ${s} : ${l} : ${c}`);
      };
      
      if ($("@isDark").me() == "Off" || $("@isDark").me() == "On") {
        if ($("@isDark").me() == "On") {
          $(window).css.replace(0, 'body { color: white; background-color: black; }');
          $(window).css.append(0, 'a { color: rgb(0, 0, 255); }');
          $("#darkMode").text.replace("On");
        }
      } else {
        $("@isDark").set("Off");
      }
      
      function toggleDarkMode() {
        if ($("@isDark").me() == "Off") {
          $(window).css.replace(0, 'body { color: white; background-color: black; }');
          $(window).css.append(0, 'a { color: rgb(0, 0, 192); }');
          $("@isDark").set("On");
          $("#darkMode").text.replace($("@isDark").me());
        } else if ($("@isDark").me() == "On") {
          $(window).css.replace(0, 'body { color: black; background-color: white; }');
          $(window).css.append(0, 'a { color: rgb(0, 0, 255); }');
          $("@isDark").set("Off");
          $("#darkMode").text.replace($("@isDark").me());
        }
      }
      
      if ($("@isOffline").me() == "Off" || $("@isOffline").me() == "On") {
        $("#offlineMode").text.replace($("@isOffline").me());
      } else {
        $("@isOffline").set("Off");
      }
      
      function toggleOffline() {
        $("#offlineMode").text.replace("Checking...");
        if('serviceWorker' in navigator) {
          if ($("@isOffline").me() == "Off") {
            $("#offlineMode").text.replace("Loading Service Workers...");

            navigator.serviceWorker.register("/PreviewLibrary.html");
            navigator.serviceWorker.register("/LibrarySource.html");
            navigator.serviceWorker.register("/AboutLibrary.html");
            navigator.serviceWorker.register("/PageOptions.html");
            navigator.serviceWorker.register("/index.html");
            
            navigator.serviceWorker.register("/assets/Library.js");
            navigator.serviceWorker.register("/assets/logo.png");
            
            navigator.serviceWorker.ready.then(function (registration) {
              console.log('Service worker successfully registered on scope', registration.scope);
            });

            $("@isOffline").set("On");
            $("#offlineMode").text.replace($("@isOffline").me());
          } else if ($("@isOffline").me() == "On") {
            $("#offlineMode").text.replace("Removing Service Workers...");
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
              for(let registration of registrations) {
                registration.unregister();
              }
            });

            $("@isOffline").set("Off");
            $("#offlineMode").text.replace($("@isOffline").me());
          } else {
            $("#offlineMode").text.replace("Something went wrong.");
          }
        } else {
          $("#offlineMode").text.replace("Your browser doesn't support Service Workers. Please use one of the major browsers, like Google Chrome.");
        }
      }
      
      self.addEventListener('install', function(event) {
        event.waitUntil(
          caches.open('calcplus-github-v3').then(function(cache) {
            return cache.addAll([
              "/assets/CPquery.js",
              "/assets/logo.png"
            ]);
          }));
      });

      self.addEventListener('install', function(event) {
        console.log('Installed PageOptions.html', event);
      });
      self.addEventListener('activate', function(event) {
        console.log('Activated PageOptions.html', event);
      });

      self.addEventListener('fetch', function(e) {
       e.respondWith(caches.match(e.request).then(function(response) {
        if(response) {
          return response;
        }
        return fetch(e.request).then(
          function(response) {
            if(!response || response.status !== 200 || response.type !== 'basic') {
              return response;
            }
            var responseToCache = response.clone();

            caches.open(calcplus-github-v3)
              .then(function(cache) {
                cache.put(e.request, responseToCache);
              });

            return response;
          }
        );
       }));
      });
    </script>
  </body>
</html>
